"use strict";

var mongo_connector_1 = require("../../backend/mongo-connector");
var model_1 = require("../../../model/model");
var logger_1 = require("../../logger");
var UserController = {
    findAll: function (req, res) {
        logger_1.logger.debug("Retrieving all users");
        mongo_connector_1.MongoUser.find({}, function (err, users) {
            if (err) return res.json(500, { message: 'ERROR', content: err });
            var response = new model_1.Response(200, { message: 'OK', content: users });
            res.json(response.status, response.body);
            res.end();
        });
    },
    findById: function (req, res) {
        var id = req.params.userId;
        logger_1.logger.debug("Search for user : " + id);
        mongo_connector_1.MongoUser.findOne({ _id: id }, function (err, user) {
            var response = err && new model_1.Response(500, {
                message: 'ERROR',
                content: err
            }) || new model_1.Response(200, { message: 'OK', content: user });
            res.json(response.status, response.body);
            res.end();
        });
    },
    create: function (req, res) {
        var body = req.body;
        if (body) {
            logger_1.logger.debug("Create user: " + body);
            body.deactivated = false;
            var mongoUser = new mongo_connector_1.MongoUser(body);
            mongoUser.save(function (err, user) {
                var response = err && new model_1.Response(500, {
                    message: 'ERROR',
                    content: err
                }) || new model_1.Response(200, { message: 'OK', content: user });
                res.json(response.status, response.body);
                res.end();
            });
        }
    },
    update: function (req, res) {
        var body = req.body;
        var id = req.params.userId;
        logger_1.logger.debug("Update user : " + id);
        if (body) {
            mongo_connector_1.MongoUser.findByIdAndUpdate(id, { $set: body }, function (err, retVal) {
                if (err) return res.json(500, { message: 'ERROR', content: err });
                var response = retVal == null && new model_1.Response(500, {
                    message: 'user not found',
                    content: {}
                }) || new model_1.Response(200, { message: 'updated user', content: {} });
                res.json(response.status, response.body);
                res.end();
            });
        }
    },
    delete: function (req, res) {
        var id = req.params.userId;
        logger_1.logger.debug("Delete user : " + id);
        mongo_connector_1.MongoUser.findByIdAndRemove(id, function (err, retVal) {
            if (err) return res.json(500, { message: 'ERROR', content: err });
            var response = retVal == null && new model_1.Response(500, {
                message: 'user not found',
                content: {}
            }) || new model_1.Response(200, { message: 'removed user', content: retVal });
            res.json(response.status, response.body);
            res.end();
        });
    },
    emailExists: function (req, res) {
        logger_1.logger.debug("Find user bey email " + req.params.email);
        mongo_connector_1.MongoUser.find({ email: req.params.email }, function (err, users) {
            if (err) return res.json(500, { message: 'ERROR', content: err });
            var response = users.length > 1 && new model_1.Response(200, {
                message: '1',
                content: {}
            }) || new model_1.Response(200, { message: '0', content: {} });
            res.json(response.status, response.body);
            res.end();
        });
    }
};
exports.UserController = UserController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlci9hcGkvdXNlci91c2VyLWNvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0EsSUFBQSxvQkFBQSxRQUF3QiwrQkFBeEIsQ0FBQTtBQUNBLElBQUEsVUFBQSxRQUE2QixzQkFBN0IsQ0FBQTtBQUNBLElBQUEsV0FBQSxRQUFxQixjQUFyQixDQUFBO0FBRUEsSUFBSSxpQkFBaUI7QUFDbkIsYUFBUyxVQUFVLEdBQVYsRUFBb0IsR0FBcEIsRUFBNEI7QUFDbkMsaUJBQUEsTUFBQSxDQUFPLEtBQVAsQ0FBYSxzQkFBYjtBQUNBLDBCQUFBLFNBQUEsQ0FBVSxJQUFWLENBQWUsRUFBZixFQUFtQixVQUFVLEdBQVYsRUFBb0IsS0FBcEIsRUFBc0M7QUFDdkQsZ0JBQUksR0FBSixFQUFTLE9BQU8sSUFBSSxJQUFKLENBQVMsR0FBVCxFQUFjLEVBQUMsU0FBUyxPQUFWLEVBQW1CLFNBQVMsR0FBNUIsRUFBZCxDQUFQO0FBQ1QsZ0JBQUksV0FBcUIsSUFBSSxRQUFBLFFBQUosQ0FBYSxHQUFiLEVBQWtCLEVBQUMsU0FBUyxJQUFWLEVBQWdCLFNBQVMsS0FBekIsRUFBbEIsQ0FBekI7QUFDQSxnQkFBSSxJQUFKLENBQVMsU0FBUyxNQUFsQixFQUEwQixTQUFTLElBQW5DO0FBQ0EsZ0JBQUksR0FBSjtBQUNELFNBTEQ7QUFNRCxLQVRrQjtBQVVuQixjQUFVLFVBQVUsR0FBVixFQUFvQixHQUFwQixFQUE0QjtBQUNwQyxZQUFJLEtBQUssSUFBSSxNQUFKLENBQVcsTUFBcEI7QUFDQSxpQkFBQSxNQUFBLENBQU8sS0FBUCxDQUFhLHVCQUFxQixFQUFsQztBQUNBLDBCQUFBLFNBQUEsQ0FBVSxPQUFWLENBQWtCLEVBQUMsS0FBSyxFQUFOLEVBQWxCLEVBQTZCLFVBQVUsR0FBVixFQUFvQixJQUFwQixFQUE4QjtBQUN6RCxnQkFBSSxXQUFzQixPQUFPLElBQUksUUFBQSxRQUFKLENBQWEsR0FBYixFQUFrQjtBQUMvQyx5QkFBUyxP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Q0FBYSxHQUFiLEVBQWtCLEVBQUMsU0FBUyxjQUFWLEVBQTBCLFNBQVMsTUFBbkMsRUFBbEIsQ0FIVDtBQUlBLGdCQUFJLElBQUosQ0FBUyxTQUFTLE1BQWxCLEVBQTBCLFNBQVMsSUFBbkM7QUFDQSxnQkFBSSxHQUFKO0FBQ0QsU0FSRDtBQVNELEtBbkVrQjtBQW9FbkIsaUJBQVcsVUFBQyxHQUFELEVBQVcsR0FBWCxFQUFtQjtBQUM1QixpQkFBQSxNQUFBLENBQU8sS0FBUCxDQUFhLHlCQUF1QixJQUFJLE1BQUosQ0FBVyxLQUEvQztBQUNBLDBCQUFBLFNBQUEsQ0FBVSxJQUFWLENBQWUsRUFBQyxPQUFPLElBQUksTUFBSixDQUFXLEtBQW5CLEVBQWYsRUFBMEMsVUFBVSxHQUFWLEVBQW9CLEtBQXBCLEVBQXNDO0FBQzlFLGdCQUFJLEdBQUosRUFBUyxPQUFPLElBQUksSUFBSixDQUFTLEdBQVQsRUFBYyxFQUFDLFNBQVMsT0FBVixFQUFtQixTQUFTLEdBQTVCLEVBQWQsQ0FBUDtBQUNULGdCQUFJLFdBQXNCLE1BQU0sTUFBTixHQUFlLENBQWYsSUFBb0IsSUFBSSxRQUFBLFFBQUosQ0FBYSxHQUFiLEVBQWtCO0FBQzVELHlCQUFTLEdBRG1EO0FBRTVELHlCQUFTO0FBRm1ELGFBQWxCLENBQXJCLElBR2hCLElBQUksUUFBQSxRQUFKLENBQWEsR0FBYixFQUFrQixFQUFDLFNBQVMsR0FBVixFQUFlLFNBQVMsRUFBeEIsRUFBbEIsQ0FIVDtBQUtBLGdCQUFJLElBQUosQ0FBUyxTQUFTLE1BQWxCLEVBQTBCLFNBQVMsSUFBbkM7QUFDQSxnQkFBSSxHQUFKO0FBQ0QsU0FURDtBQVVEO0FBaEZrQixDQUFyQjtBQW1GUSxRQUFBLGNBQUEsR0FBYyxjQUFkIiwiZmlsZSI6InNlcnZlci9hcGkvdXNlci91c2VyLWNvbnRyb2xsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbmltcG9ydCB7TW9uZ29Vc2VyfSBmcm9tIFwiLi4vLi4vYmFja2VuZC9tb25nby1jb25uZWN0b3JcIjtcbmltcG9ydCB7VXNlciwgUmVzcG9uc2V9IGZyb20gXCIuLi8uLi8uLi9tb2RlbC9tb2RlbFwiO1xuaW1wb3J0IHtsb2dnZXJ9IGZyb20gXCIuLi8uLi9sb2dnZXJcIjtcblxudmFyIFVzZXJDb250cm9sbGVyID0ge1xuICBmaW5kQWxsOiBmdW5jdGlvbiAocmVxOiBhbnksIHJlczogYW55KSB7XG4gICAgbG9nZ2VyLmRlYnVnKGBSZXRyaWV2aW5nIGFsbCB1c2Vyc2ApO1xuICAgIE1vbmdvVXNlci5maW5kKHt9LCBmdW5jdGlvbiAoZXJyOiBhbnksIHVzZXJzOiBBcnJheTxVc2VyPikge1xuICAgICAgaWYgKGVycikgcmV0dXJuIHJlcy5qc29uKDUwMCwge21lc3NhZ2U6ICdFUlJPUicsIGNvbnRlbnQ6IGVycn0pO1xuICAgICAgbGV0IHJlc3BvbnNlOiBSZXNwb25zZSA9IG5ldyBSZXNwb25zZSgyMDAsIHttZXNzYWdlOiAnT0snLCBjb250ZW50OiB1c2Vyc30pO1xuICAgICAgcmVzLmpzb24ocmVzcG9uc2Uuc3RhdHVzLCByZXNwb25zZS5ib2R5KTtcbiAgICAgIHJlcy5lbmQoKTtcbiAgICB9KTtcbiAgfSxcbiAgZmluZEJ5SWQ6IGZ1bmN0aW9uIChyZXE6IGFueSwgcmVzOiBhbnkpIHtcbiAgICBsZXQgaWQgPSByZXEucGFyYW1zLnVzZXJJZDtcbiAgICBsb2dnZXIuZGVidWcoYFNlYXJjaCBmb3IgdXNlciA6ICR7aWR9YCk7XG4gICAgTW9uZ29Vc2VyLmZpbmRPbmUoe19pZDogaWR9LCBmdW5jdGlvbiAoZXJyOiBhbnksIHVzZXI6IFVzZXIpIHtcbiAgICAgIGxldCByZXNwb25zZTogUmVzcG9uc2UgPSAoZXJyICYmIG5ldyBSZXNwb25zZSg1MDAsIHtcbiAgICAgICAgICBtZXNzYWdlOiAnRVJST1InLFxuICAgICAgICAgIGNvbnRlbnQ6IGVyclxuICAgICAgICB9KSkgfHwgbmV3IFJlc3BvbnNlKDIwMCwge21lc3NhZ2U6ICdPSycsIGNvbnRlbnQ6IHVzZXJ9KTtcbiAgICAgIHJlcy5qc29uKHJlc3BvbnNlLnN0YXR1cywgcmVzcG9uc2UuYm9keSk7XG4gICAgICByZXMuZW5kKCk7XG4gICAgfSk7XG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gKHJlcTogYW55LCByZXM6IGFueSkge1xuICAgIHZhciBib2R5OiBVc2VyID0gcmVxLmJvZHk7XG4gICAgaWYgKGJvZHkpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgQ3JlYXRlIHVzZXI6ICR7Ym9keX1gKTtcbiAgICAgIGJvZHkuZGVhY3RpdmF0ZWQgPSBmYWxzZTtcbiAgICAgIGxldCBtb25nb1VzZXIgPSBuZXcgTW9uZ29Vc2VyKGJvZHkpO1xuICAgICAgbW9uZ29Vc2VyLnNhdmUoZnVuY3Rpb24gKGVycjogYW55LCB1c2VyOiBVc2VyKSB7XG4gICAgICAgIGxldCByZXNwb25zZTogUmVzcG9uc2UgPSAoZXJyICYmIG5ldyBSZXNwb25zZSg1MDAsIHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdFUlJPUicsXG4gICAgICAgICAgICBjb250ZW50OiBlcnJcbiAgICAgICAgICB9KSkgfHwgbmV3IFJlc3BvbnNlKDIwMCwge21lc3NhZ2U6ICdPSycsIGNvbnRlbnQ6IHVzZXJ9KTtcbiAgICAgICAgcmVzLmpzb24ocmVzcG9uc2Uuc3RhdHVzLCByZXNwb25zZS5ib2R5KTtcbiAgICAgICAgcmVzLmVuZCgpO1xuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24gKHJlcTogYW55LCByZXM6IGFueSkge1xuICAgIHZhciBib2R5OiBVc2VyID0gcmVxLmJvZHk7XG4gICAgdmFyIGlkID0gcmVxLnBhcmFtcy51c2VySWQ7XG4gICAgbG9nZ2VyLmRlYnVnKGBVcGRhdGUgdXNlciA6ICR7aWR9YCk7XG4gICAgaWYgKGJvZHkpIHtcbiAgICAgIE1vbmdvVXNlci5maW5kQnlJZEFuZFVwZGF0ZShpZCwgeyRzZXQ6IGJvZHl9LCBmdW5jdGlvbiAoZXJyOiBhbnksIHJldFZhbDogVXNlcikge1xuICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLmpzb24oNTAwLCB7bWVzc2FnZTogJ0VSUk9SJywgY29udGVudDogZXJyfSk7XG4gICAgICAgIGxldCByZXNwb25zZTogUmVzcG9uc2UgPSAocmV0VmFsID09IG51bGwgJiYgbmV3IFJlc3BvbnNlKDUwMCwge1xuICAgICAgICAgICAgbWVzc2FnZTogJ3VzZXIgbm90IGZvdW5kJyxcbiAgICAgICAgICAgIGNvbnRlbnQ6IHt9XG4gICAgICAgICAgfSkpIHx8IG5ldyBSZXNwb25zZSgyMDAsIHttZXNzYWdlOiAndXBkYXRlZCB1c2VyJywgY29udGVudDoge319KTtcbiAgICAgICAgcmVzLmpzb24ocmVzcG9uc2Uuc3RhdHVzLCByZXNwb25zZS5ib2R5KTtcbiAgICAgICAgcmVzLmVuZCgpO1xuICAgICAgfSk7XG4gICAgfVxuICB9LFxuICBkZWxldGU6IGZ1bmN0aW9uIChyZXE6IGFueSwgcmVzOiBhbnkpIHtcbiAgICB2YXIgaWQgPSByZXEucGFyYW1zLnVzZXJJZDtcbiAgICBsb2dnZXIuZGVidWcoYERlbGV0ZSB1c2VyIDogJHtpZH1gKTtcbiAgICBNb25nb1VzZXIuZmluZEJ5SWRBbmRSZW1vdmUoaWQsIGZ1bmN0aW9uIChlcnI6IGFueSwgcmV0VmFsOiBVc2VyKSB7XG4gICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLmpzb24oNTAwLCB7bWVzc2FnZTogJ0VSUk9SJywgY29udGVudDogZXJyfSk7XG4gICAgICBsZXQgcmVzcG9uc2U6IFJlc3BvbnNlID0gKHJldFZhbCA9PSBudWxsICYmIG5ldyBSZXNwb25zZSg1MDAsIHtcbiAgICAgICAgICBtZXNzYWdlOiAndXNlciBub3QgZm91bmQnLFxuICAgICAgICAgIGNvbnRlbnQ6IHt9XG4gICAgICAgIH0pKSB8fCBuZXcgUmVzcG9uc2UoMjAwLCB7bWVzc2FnZTogJ3JlbW92ZWQgdXNlcicsIGNvbnRlbnQ6IHJldFZhbH0pO1xuICAgICAgcmVzLmpzb24ocmVzcG9uc2Uuc3RhdHVzLCByZXNwb25zZS5ib2R5KTtcbiAgICAgIHJlcy5lbmQoKTtcbiAgICB9KTtcbiAgfSxcbiAgZW1haWxFeGlzdHMocmVxOiBhbnksIHJlczogYW55KXtcbiAgICBsb2dnZXIuZGVidWcoYEZpbmQgdXNlciBiZXkgZW1haWwgJHtyZXEucGFyYW1zLmVtYWlsfWApO1xuICAgIE1vbmdvVXNlci5maW5kKHtlbWFpbDogcmVxLnBhcmFtcy5lbWFpbH0sIGZ1bmN0aW9uIChlcnI6IGFueSwgdXNlcnM6IEFycmF5PFVzZXI+KSB7XG4gICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLmpzb24oNTAwLCB7bWVzc2FnZTogJ0VSUk9SJywgY29udGVudDogZXJyfSk7XG4gICAgICBsZXQgcmVzcG9uc2U6IFJlc3BvbnNlID0gKHVzZXJzLmxlbmd0aCA+IDEgJiYgbmV3IFJlc3BvbnNlKDIwMCwge1xuICAgICAgICAgIG1lc3NhZ2U6ICcxJyxcbiAgICAgICAgICBjb250ZW50OiB7fVxuICAgICAgICB9KSkgfHwgbmV3IFJlc3BvbnNlKDIwMCwge21lc3NhZ2U6ICcwJywgY29udGVudDoge319KTtcblxuICAgICAgcmVzLmpzb24ocmVzcG9uc2Uuc3RhdHVzLCByZXNwb25zZS5ib2R5KTtcbiAgICAgIHJlcy5lbmQoKTtcbiAgICB9KTtcbiAgfVxufTtcblxuZXhwb3J0IHtVc2VyQ29udHJvbGxlcn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
